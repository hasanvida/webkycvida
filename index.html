<!DOCTYPE html>
<html>
<head>
  <title>VIDA Identity Verification</title>
  <script src="https://cdn.sandbox.vida.id/web-sdk/v2/vida-web-sdk.js"></script>
</head>
<body>

  <h2>VIDA Identity Verification Demo</h2>
  <button id="startBtn">Start Verification</button>

  <div id="vida-container" style="margin-top:20px;"></div>

  <script>
    let vidaInstance = null;

    document.getElementById("startBtn").addEventListener("click", async function () {

      try {

        console.log("Requesting token from Netlify function...");

        // ðŸ”¥ Ambil token dari get-token.js
        const res = await fetch("/.netlify/functions/get-token");
        const tokenData = await res.json();

        console.log("Token response:", tokenData);

        if (!tokenData.access_token) {
          alert("Failed to obtain access token");
          return;
        }

        // ðŸ”¥ Reset container supaya tidak blank
        document.getElementById("vida-container").innerHTML = "";

        if (vidaInstance) {
          vidaInstance.destroy();
          vidaInstance = null;
        }

        vidaInstance = new VidaWebSdk({
          containerId: "vida-container",
          accessToken: tokenData.access_token,

          workflowConfigs: {
            identityVerification: {
              userConsent: {
                obtained: true,
                obtainedAt: Date.now(),
              },
              docVerification: {
                skipDocBackSideCapture: true,
                maxRetryAttempts: 3,
              },
              faceMatch: {
                maxRetryAttempts: 3,
              }
            }
          },

          onSuccess: function (response) {
            console.log("Verification Success:", response);
            alert("Verification Completed");
          },

          onError: function (error) {
            console.error("Verification Error:", error);
            alert("Verification Failed");
          }

        });

        vidaInstance.start();

      } catch (error) {
        console.error("Error fetching token:", error);
        alert("Error fetching token");
      }

    });
  </script>

</body>
</html>
