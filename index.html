<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Vida Web SDK Test</title>
  <script src="https://unpkg.com/vida-web-sdk/dist/vida-web-sdk.umd.js"></script>
</head>
<body>

  <h2>Vida Identity Verification Test</h2>

  <button onclick="startVerification()">Start Identity Verification</button>

  <br /><br />

  <!-- SDK Container (WAJIB ADA & HARUS SAMA DENGAN elementId) -->
  <div id="sdk-container"></div>

  <script>
    async function startVerification() {
      console.log("Fetching token from backend...");

      try {
        const res = await fetch('/.netlify/functions/get-token');
        const data = await res.json();

        console.log("Token received:", data);

        if (!data.access_token || !data.signing_key) {
          alert("Token or Signing Key missing!");
          return;
        }

        console.log("Initializing SDK...");

        window.VidaSDK.init({
          token: data.access_token,              // ⚠️ WAJIB token (bukan accessToken)
          signingKey: data.signing_key,          // ⚠️ WAJIB ada
          elementId: "sdk-container",            // ⚠️ HARUS sama dengan div id
          workflow: "identity-verification",     // ⚠️ MANDATORY
          countryCode: "IDN",                    // ⚠️ WAJIB isi
          locale: "EN",
          partnerTransactionId: crypto.randomUUID(),

          workflowConfigs: {
            identityVerification: {
              userConsent: {
                obtained: true,
                obtainedAt: Date.now(),
              },
              docVerification: {
                skipDocBackSideCapture: false,
                skipIntroductionScreen: false,
                skipDocSelectionScreen: false,
                skipTutorialScreen: false,
                maxRetryAttempts: 3,
                captureTimeOut: 120000,
              },
              faceMatch: {
                skipTutorialScreen: false,
                maxRetryAttempts: 3,
                detectionTimeOut: 120000,
              }
            }
          },

          onComplete: (data) => {
            console.log("Verification completed:", data);
            alert("Verification Completed!");
          },

          onError: (error) => {
            console.error("Verification error:", error);
            alert("Error occurred. Check console.");
          }
        });

      } catch (err) {
        console.error("Failed to start:", err);
      }
    }
  </script>

</body>
</html>
