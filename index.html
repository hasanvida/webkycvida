<script>
document.getElementById("startBtn").addEventListener("click", async function () {

  try {

    // ðŸ”¥ Ambil token dari Netlify Function
    const res = await fetch("/.netlify/functions/token");
    const tokenData = await res.json();

    if (!tokenData.access_token) {
      alert("Failed to get token");
      console.error(tokenData);
      return;
    }

    // ðŸ”¥ Reset container biar tidak blank
    document.getElementById("vida-container").innerHTML = "";

    const vida = new VidaWebSdk({
      containerId: "vida-container",
      accessToken: tokenData.access_token,

      workflowConfigs: {
        identityVerification: {
          userConsent: {
            obtained: true,
            obtainedAt: Date.now(),
          },
          docVerification: {
            skipDocBackSideCapture: true,
            maxRetryAttempts: 3,
          },
          faceMatch: {
            maxRetryAttempts: 3,
          }
        }
      },

      onSuccess: function (response) {
        console.log("Success:", response);
      },

      onError: function (error) {
        console.error("Error:", error);
      }
    });

    vida.start();

  } catch (err) {
    console.error("Token fetch error:", err);
  }

});
</script>
