<!DOCTYPE html>
<html>
<head>
  <title>Vida Web SDK Debug Demo</title>
  <script src="https://web-sdk.vida.id/1.1.0/sandbox/vida-web-sdk.js"></script>
  <style>
    body { font-family: Arial; padding: 40px; background: #f4f6f9; }
    button {
      padding: 10px 18px;
      margin-right: 10px;
      margin-bottom: 10px;
      background: #0d6efd;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #sdk-container { margin-top: 20px; }
    #log-box {
      margin-top: 20px;
      background: #111;
      color: #0f0;
      padding: 15px;
      border-radius: 6px;
      font-size: 12px;
      height: 200px;
      overflow: auto;
    }
  </style>
</head>

<body>

<h2>Vida Web SDK Debug (Sandbox)</h2>

<button onclick="startDoc()">Document Verification</button>
<button onclick="startLiveness()">Liveness</button>
<button onclick="startFull()">Full Identity</button>

<div id="sdk-container"></div>
<div id="log-box"></div>

<script>

function log(message) {
  console.log(message);
  const logBox = document.getElementById("log-box");
  logBox.innerHTML += message + "\n";
}

async function getToken() {
  log("Fetching token from backend...");
  const response = await fetch("/.netlify/functions/get-token");

  if (!response.ok) {
    throw new Error("Token API failed: " + response.status);
  }

  const data = await response.json();
  log("Token received");
  return data;
}

async function initWorkflow(type) {
  try {
    log("Starting workflow: " + type);

    document.getElementById("sdk-container").innerHTML = "";

    if (!window.VidaSDK) {
      log("ERROR: VidaSDK not loaded!");
      return;
    }

    const data = await getToken();

    log("Initializing SDK...");

    window.VidaSDK.init({
      token: data.token,
      signingKey: data.signingKey,
      elementId: "sdk-container",
      workflow: type,
      countryCode: "IDN",
      locale: "EN",
      partnerTransactionId: crypto.randomUUID(),

      workflowConfigs: {
        identityVerification: {
          userConsent: {
            obtained: true,
            obtainedAt: Date.now(),
          },
        }
      },

      onComplete: (result) => {
        log("Workflow Completed");
        log(JSON.stringify(result));
      },

      onError: (error) => {
        log("Workflow Error:");
        log(JSON.stringify(error));
      },
    });

  } catch (err) {
    log("Exception:");
    log(err.message);
  }
}

function startDoc() {
  initWorkflow("document-verification");
}

function startLiveness() {
  initWorkflow("liveness");
}

function startFull() {
  initWorkflow("identity-verification");
}

</script>

</body>
</html>
